import{b as p}from"./GeneralForm-65bc43e6.js";import{_}from"./AuthorChips-ea3f2366.js";import h from"./PluginTasksList-15603e1f.js";import{_ as f}from"./TechniqueChips-fbe88c34.js";import{b,_ as l,a as u,c as y}from"./ErrorStateAlert-54a1fc69.js";import{a as v}from"./ListPageTop-beafc66e.js";import{_ as k}from"./EditPageTop-cc816a05.js";import{n as x,aM as $,aN as P,aO as T,aP as C,b as a,c as n,a as c,y as g,z as m,ac as d}from"./index-58f4050c.js";import{V as S}from"./VueMarkdown-85be3575.js";import{_ as w,a as r,b as E,c as o}from"./VTabItem-9274be83.js";import{_ as O}from"./VSwitch-c29d83be.js";import"./VSelect-01110476.js";import"./bypass-module-c3821ce9.js";import"./bypass-api-dffd101a.js";import"./credential-module-ef0a3e69.js";import"./malleable-module-bc4ffaca.js";import"./malleable-api-929708b6.js";import"./TagViewer-d2a9991d.js";import"./DateTimeDisplay-e444a8c1.js";import"./moment-fbc5633a.js";import"./VTooltip-8f539ce9.js";import"./TooltipButton-7f590e14.js";import"./index-3d47a76b.js";import"./ansi_up-8f643d6a.js";import"./download-stager-ae353708.js";import"./VPagination-686cbc34.js";import"./VDataTable-05bb859a.js";import"./ExpansionPanelFilter-5ac7ff9f.js";import"./VExpansionPanelHeader-570c2e65.js";import"./ExpansionPanelSearch-cbf26ff4.js";import"./AdvancedTable-c96bc260.js";import"./VExpansionPanels-6f783ece.js";import"./VItemGroup-01fc0587.js";import"./tag-api-b655f007.js";const q={name:"PluginEdit",components:{AuthorChips:_,GeneralForm:p,TechniqueChips:f,EditPageTop:k,PluginTasksList:h,TooltipButtonToggle:v,ErrorStateAlert:b,VueMarkdown:S},data(){return{reset:!0,loading:!1,isRefreshTasks:!1,initialLoad:!1,form:{},settingsForm:{},plugin:{execution_options:{}},errorState:!1}},computed:{breads(){return[{text:"Plugins",disabled:!1,to:"/plugins",exact:!0},{text:this.breadcrumbName,disabled:!0,to:"/plugins/edit"}]},breadcrumbName(){return this.plugin.name?this.plugin.name:this.id?this.id:""},pluginOptions(){const{execution_options:e}=this.plugin;return e||{}},pluginSettingsOptions(){const e={};return Object.keys(this.plugin.settings_options).forEach(t=>{e[t]={...this.plugin.settings_options[t]},e[t].value=this.plugin.current_settings[t]}),e},id(){return this.$route.params.id},tab:{set(e){this.$router.replace({query:{...this.$route.query,tab:e}})},get(){return this.$route.query.tab?this.$route.query.tab:this.interactDisabled?"details":"interact"}},interactDisabled(){return!this.plugin||!this.plugin.loaded||!this.plugin.enabled||!this.plugin.execution_enabled},pluginPythonDeps(){return!this.plugin.python_deps.length>0?`
Plugin wasn't loaded. Check the server logs.
`:`
This plugin requires additional Python dependencies.
Please install and restart the server.
\`\`\`sh
poetry add ${this.plugin.python_deps.join(" ")}
\`\`\`
      `}},mounted(){this.getPlugin(this.id)},methods:{async submit(){if(!(this.loading||!this.$refs.generalform.$refs.form.validate())){this.loading=!0;try{const e=await $(this.plugin.id,this.form);this.$snack.success(`${e.detail}`)}catch(e){this.$snack.error(`Error: ${e}`)}this.loading=!1}},async submitSettings(){if(!(this.loading||!this.$refs.settingsform.$refs.form.validate())){this.loading=!0;try{await P(this.plugin.id,this.settingsForm),await this.getPlugin(this.id),this.$snack.success("Settings updated")}catch(e){this.$snack.error(`Error: ${e}`)}this.loading=!1}},async toggleEnabled(e){this.plugin.enabled=e;try{const t=await T({...this.plugin,options:this.form});this.plugin=t}catch(t){this.plugin.enabled=!e,this.$snack.error(`Error: ${t}`)}},getPlugin(e){C(e).then(t=>{this.reset=!1,this.plugin=t,setTimeout(()=>{this.reset=!0},500)}).catch(()=>{this.errorState=!0}).finally(()=>{this.initialLoad=!0})}}};var D=function(){var t=this,s=t._self._c;return s("div",{staticClass:"p4"},[s("portal",{attrs:{to:"app-bar-extension"}},[s("div",{staticStyle:{display:"flex","flex-direction":"row",width:"100%"}},[s(w,{attrs:{"align-with-title":""},model:{value:t.tab,callback:function(i){t.tab=i},expression:"tab"}},[s(r,{key:"interact",attrs:{href:"#interact",disabled:t.interactDisabled}},[t._v(" Interact "),s(a,{staticClass:"ml-1",attrs:{"x-small":""}},[t._v(" fa-terminal ")])],1),s(r,{key:"tasks",attrs:{href:"#tasks",disabled:!t.plugin.loaded}},[t._v(" Tasks "),s(a,{staticClass:"ml-1",attrs:{"x-small":""}},[t._v(" fa-sticky-note ")])],1),s(r,{key:"details",attrs:{href:"#details"}},[t._v(" Details "),s(a,{staticClass:"ml-1",attrs:{"x-small":""}},[t._v(" fa-info-circle ")])],1),s(r,{key:"settings",attrs:{href:"#settings",disabled:!t.plugin.loaded}},[t._v(" Settings "),s(a,{staticClass:"ml-1",attrs:{"x-small":""}},[t._v(" fa-cog ")])],1)],1)],1)]),s(k,{attrs:{breads:t.breads,"show-submit":!1,"show-copy":!1,"show-delete":!1,"submit-loading":t.loading},on:{submit:t.submit},scopedSlots:t._u([{key:"extra-stuff",fn:function(){return[t.plugin.loaded?s(v,{attrs:{icon:"fa-redo","button-text":t.isRefreshTasks?"On":"Off",text:"Auto-refresh Tasks"},model:{value:t.isRefreshTasks,callback:function(i){t.isRefreshTasks=i},expression:"isRefreshTasks"}}):t._e(),s(O,{staticClass:"mr-2 mt-3",attrs:{disabled:!t.plugin.loaded,color:"green",label:"Enabled"},on:{change:t.toggleEnabled},model:{value:t.plugin.enabled,callback:function(i){t.$set(t.plugin,"enabled",i)},expression:"plugin.enabled"}})]},proxy:!0}])}),t.errorState?s(b,{attrs:{"resource-id":t.id,"resource-type":"plugin"}}):s(E,{staticClass:"scrollable-pane",model:{value:t.tab,callback:function(i){t.tab=i},expression:"tab"}},[s(o,{key:"interact",attrs:{value:"interact",transition:!1,"reverse-transition":!1}},[s("h4",{staticClass:"pl-4 pb-4"},[t._v("Execute Plugin")]),s(n,{staticStyle:{padding:"10px"}},[s(f,{attrs:{techniques:t.plugin.TechniqueChips}}),t.reset?s(p,{ref:"generalform",attrs:{options:t.pluginOptions},model:{value:t.form,callback:function(i){t.form=i},expression:"form"}}):t._e(),s(c,{attrs:{disabled:!t.plugin.enabled,loading:t.loading,color:"primary"},on:{click:t.submit}},[t._v(" Submit ")])],1)],1),s(o,{key:"tasks",attrs:{value:"tasks",transition:!1,"reverse-transition":!1}},[s(n,{attrs:{flat:""}},[s(h,{attrs:{plugin:t.plugin,"refresh-tasks":t.isRefreshTasks,"use-header":!1}})],1)],1),t.initialLoad?s(o,{key:"details",attrs:{value:"details",transition:!1,"reverse-transition":!1}},[s(n,{attrs:{flat:""}},[s(g,[t._v("Details")]),s(m,[s(l,[s(u,{attrs:{cols:"12"}},[t.plugin.loaded?t._e():s("span",[s(y,{attrs:{prominent:"",type:"warning",outlined:""}},[s(l,{attrs:{align:"center"}},[s(u,{staticClass:"grow"},[s("vue-markdown",{attrs:{source:t.pluginPythonDeps,options:{html:!0}}})],1)],1)],1)],1),s(d),t._v(" Authors: "),s(_,{attrs:{authors:t.plugin.authors}}),s(d),t.plugin.readme?s(n,{staticClass:"pa-4",attrs:{outlined:"",elevation:"2"}},[s("vue-markdown",{attrs:{source:t.plugin.readme}})],1):t._e()],1)],1)],1)],1)],1):t._e(),s(o,{key:"settings",attrs:{value:"settings",transition:!1,"reverse-transition":!1}},[s(n,{attrs:{flat:""}},[s(g,[t._v("Settings")]),s(m,[s(l,[s(u,{attrs:{cols:"12"}},[Object.keys(t.plugin.settings_options||{})==0?s("span",[t._v("No settings available")]):[t.reset?s(p,{ref:"settingsform",attrs:{options:t.pluginSettingsOptions},model:{value:t.settingsForm,callback:function(i){t.settingsForm=i},expression:"settingsForm"}}):t._e(),s(c,{attrs:{loading:t.loading,color:"primary"},on:{click:t.submitSettings}},[t._v(" Submit ")])]],2)],1)],1)],1)],1)],1)],1)},F=[],R=x(q,D,F,!1,null,null,null,null);const _t=R.exports;export{_t as default};
