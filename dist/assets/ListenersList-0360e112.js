import{_ as o}from"./TagViewer-d2a9991d.js";import{_ as u}from"./DateTimeDisplay-e444a8c1.js";import{h as c}from"./moment-fbc5633a.js";import{n as d,j as _,k as v,l as k,m as T,o as y,p as $,a as L,b as a,d as b,e as i,f as l,i as x}from"./index-58f4050c.js";import{_ as w}from"./VDataTable-05bb859a.js";import{_ as m}from"./ExpansionPanelFilter-5ac7ff9f.js";import{_ as p}from"./AdvancedTable-c96bc260.js";import{_ as g}from"./ListPageTop-beafc66e.js";import{g as S}from"./tag-api-b655f007.js";import"./VSelect-01110476.js";import"./VTooltip-8f539ce9.js";import"./VExpansionPanelHeader-570c2e65.js";import"./VExpansionPanels-6f783ece.js";import"./VItemGroup-01fc0587.js";const E={name:"ListenersTable",components:{DateTimeDisplay:u,TagViewer:o},props:{input:{type:Array,default:()=>[]},selectedTags:{type:Array,default:()=>[]}},data(){return{moment:c,headers:[{text:"",align:"start",sortable:!1,width:"5px",value:"enabled"},{text:"Name",value:"name"},{text:"Template",value:"template"},{text:"Host",value:"options.Host"},{text:"Port",value:"options.Port"},{text:"Created At",value:"created_at"},{text:"Tags",value:"tags",sortable:!1},{text:"Actions",value:"actions",sortable:!1}],selected:[]}},computed:{listenerStore(){return _()},listenersStatus(){return this.listenerStore.status},sortedListeners(){let n=this.listenerStore.listeners.slice();return this.selectedTags.length===0||(n=n.filter(e=>e.tags.map(s=>`${s.name}:${s.value}`).some(s=>this.selectedTags.includes(s)))),n}},watch:{selectedTags(){this.getListeners()},selected(n){this.$emit("input",n)}},mounted(){this.getListeners()},methods:{deleteTag(n,e){v(n.id,e.id).then(()=>{n.tags=n.tags.filter(t=>t.id!==e.id),this.$emit("refresh-tags")}).catch(t=>this.$snack.error(`Error: ${t}`))},updateTag(n,e){k(n.id,e).then(t=>{const s=n.tags.findIndex(r=>r.id===t.id);n.tags.splice(s,1,t),this.$emit("refresh-tags"),this.$snack.success("Tag updated")}).catch(t=>this.$snack.error(`Error: ${t}`))},addTag(n,e){T(n.id,e).then(t=>{n.tags.push(t),this.$emit("refresh-tags")}).catch(t=>this.$snack.error(`Error: ${t}`))},async killListener(n){this.$emit("kill-listener",n)},getListeners(){this.listenerStore.getListeners()}}};var A=function(){var e=this,t=e._self._c;return t("div",[t(w,{attrs:{loading:e.listenersStatus==="loading",headers:e.headers,items:e.sortedListeners,"footer-props":{itemsPerPageOptions:[5,10,15,20,50,100]},"items-per-page":15,"item-key":"id",dense:"","show-select":""},scopedSlots:e._u([{key:"item.enabled",fn:function({item:s}){return[t(y,{attrs:{dot:"",color:s.enabled===!0?"green":"red"}})]}},{key:"item.name",fn:function({item:s}){return[t("router-link",{staticStyle:{color:"inherit"},attrs:{to:{name:"listenerEdit",params:{id:s.id}}}},[e._v(" "+e._s(s.name)+" ")])]}},{key:"item.created_at",fn:function({item:s}){return[t(u,{attrs:{timestamp:s.created_at}})]}},{key:"item.tags",fn:function({item:s}){return[t(o,{attrs:{tags:s.tags},on:{"update-tag":function(r){return e.updateTag(s,...arguments)},"delete-tag":function(r){return e.deleteTag(s,...arguments)},"new-tag":function(r){return e.addTag(s,...arguments)}}})]}},{key:"item.actions",fn:function({item:s}){return[t($,{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:r,attrs:h}){return[t(L,e._g(e._b({attrs:{text:"",icon:"","x-small":""}},"v-btn",h,!1),r),[t(a,[e._v("fa-ellipsis-v")])],1)]}}],null,!0)},[t(b,{staticClass:"ml-2 mr-2"},[t(i,{key:"view",attrs:{link:""}},[t("router-link",{staticClass:"text-decoration-none",staticStyle:{color:"inherit"},attrs:{to:{name:"listenerEdit",params:{id:s.id}}}},[t(l,[t(a,[e._v("fa-binoculars")]),e._v(" View ")],1)],1)],1),t(i,{key:"copy",attrs:{to:{name:"listenerNew",params:{copy:!0,id:s.id}},link:""}},[t(l,[t(a,[e._v("fa-clone")]),e._v(" Copy ")],1)],1),t(x,{staticClass:"pb-4"}),t(i,{key:"delete",attrs:{link:""},on:{click:function(r){return e.killListener(s)}}},[t(l,[t(a,[e._v("fa-trash-alt")]),e._v(" Delete ")],1)],1)],1)],1)]}}]),model:{value:e.selected,callback:function(s){e.selected=s},expression:"selected"}})],1)},D=[],C=d(E,A,D,!1,null,null,null,null);const f=C.exports;const P={name:"Listeners",components:{AdvancedTable:p,ListenersTable:f,ExpansionPanelFilter:m,ListPageTop:g},data(){return{moment:c,breads:[{text:"Listeners",disabled:!0,href:"/listeners"}],selected:[],tags:[],selectedTags:[]}},computed:{listenerStore(){return _()},listenersStatus(){return this.listenerStore.status},showDelete(){return this.selected.length>0}},mounted(){this.getListeners(),this.getTags()},methods:{async getTags(){const n=await S({page:1,limit:-1,sources:"listener"}),e=[];n.records.forEach(t=>{e.find(r=>r.name===t.name&&r.value===t.value)||e.push(t)}),this.tags=e},create(){this.$router.push({name:"listenerNew"})},async killListener(n){await this.$root.$confirm("Delete",`Are you sure you want to kill listener ${n.name}?`,{color:"red"})&&await this.listenerStore.killListener(n.id)},async killListeners(){await this.$root.$confirm("Delete",`Are you sure you want to kill ${this.selected.length} listeners?`,{color:"red"})&&(this.selected.forEach(n=>{this.listenerStore.killListener(n.id)}),this.selected=[])},getListeners(){this.$refs.listenersTable.getListeners()}}};var F=function(){var e=this,t=e._self._c;return t("div",{},[t(g,{attrs:{breads:e.breads,"show-create":!0,"show-refresh":!0,"refresh-loading":e.listenersStatus==="loading","show-delete":e.showDelete},on:{create:e.create,delete:e.killListeners,refresh:e.getListeners}}),t(p,{scopedSlots:e._u([{key:"filters",fn:function(){return[t(m,{attrs:{title:"Tags",label:"label","item-key":"id","item-value":"label",items:e.tags,"empty-default":!0},model:{value:e.selectedTags,callback:function(s){e.selectedTags=s},expression:"selectedTags"}})]},proxy:!0},{key:"table",fn:function(){return[t(f,{ref:"listenersTable",attrs:{"selected-tags":e.selectedTags},on:{"kill-listener":e.killListener},model:{value:e.selected,callback:function(s){e.selected=s},expression:"selected"}})]},proxy:!0}])})],1)},N=[],V=d(P,F,N,!1,null,null,null,null);const W=V.exports;export{W as default};
