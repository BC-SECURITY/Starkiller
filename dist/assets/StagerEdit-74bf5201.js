import{b as l,a as c}from"./GeneralForm-0135bd41.js";import{_ as d}from"./InfoViewer-8b973e14.js";import{b as m,_ as g,a as n}from"./ErrorStateAlert-4ecc5b9a.js";import{_ as i}from"./TooltipButton-5f12a11c.js";import{_ as u}from"./EditPageTop-297fabe6.js";import{n as h,G as _,H as f,c as y,q as w}from"./index-53847554.js";import{C as S,u as b,g as $,a as T,c as v,b as x}from"./stager-module-8fd5d6c8.js";import{_ as L}from"./VSelect-1a2d5ce2.js";import"./VSwitch-dacf414c.js";import"./bypass-module-89fb9fdf.js";import"./bypass-api-b460392c.js";import"./credential-module-c556dff4.js";import"./malleable-module-76906aed.js";import"./malleable-api-df01e8ce.js";import"./AuthorChips-c9ac2ca3.js";import"./VExpansionPanels-15197b23.js";import"./VItemGroup-6e204b73.js";import"./VExpansionPanelHeader-a884139e.js";import"./VTooltip-7fdb9790.js";const k={name:"StagerEdit",components:{InfoViewer:d,GeneralForm:l,ErrorStateAlert:m,EditPageTop:u,TooltipButton:i},mixins:[S],data(){return{stager:{options:{}},stagerTemplate:{options:{}},selectedTemplate:"",form:{},reset:!0,loading:!1,formPriorities:["Listener","Language"],errorState:!1,initialLoad:!1}},computed:{stagerStore(){return b()},stagerTemplateIds(){return this.stagerStore.templateIds},isNew(){return this.$route.name==="stagerNew"},isCopy(){return this.$route.params.copy===!0},mode(){return this.isCopy?"Copy":this.isNew?"New":"View"},canEdit(){return!0},id(){return this.isCopy?0:this.$route.params.id},copyLink(){return this.id>0?{name:"stagerNew",params:{copy:!0,id:this.id}}:{}},stagerInfo(){if(!this.stagerTemplate)return{};const e=this.stagerTemplate;return{authors:e.authors,description:e.description,comments:e.comments}},stagerOptions(){if(!this.isNew||this.isCopy){const s={},r=this.stagerTemplate&&this.stagerTemplate.options||{},o=this.stager&&this.stager.options?this.stager.options:{};return Object.keys(o).forEach(a=>{const p=r[a]?{...r[a]}:{};s[a]=p,s[a].value=o[a]}),s}const e=this.stagerTemplate&&this.stagerTemplate.options||{},t=Object.keys(e).reduce((s,r)=>(s[r]={...e[r]},s),{});return Object.keys(t).length===0?{}:(this.$route.query.listener&&t.Listener&&(t.Listener.value=this.$route.query.listener),t)},breads(){return[{text:"Stagers",disabled:!1,to:"/stagers",exact:!0},{text:this.breadcrumbName,disabled:!0,to:"/stagers-edit"}]},breadcrumbName(){return this.isCopy?"New":this.stager.name?this.stager.name:this.id?this.id:"New"}},watch:{selectedTemplate:{async handler(e){const t=await $(e).catch(s=>this.$snack.error(`Error: ${s}`));t&&(this.reset=!1,this.stagerTemplate=t,await this.$nextTick(),this.reset=!0,this.initialLoad=!0)}},id(e){e&&this.getStager(e)}},mounted(){this.stagerStore.getStagerTemplates(),(!this.isNew||this.isCopy)&&this.getStager(this.$route.params.id),this.$route.query.template&&(this.selectedTemplate=this.$route.query.template)},methods:{submit(){this.loading||!this.$refs.generalform.$refs.form.validate()||(this.loading=!0,this.id>0?T(this.id,{name:this.stager.name,options:this.form}).then(()=>{this.$snack.success("Stager updated"),this.loading=!1}).then(()=>{this.getStager(this.id)}).catch(e=>{this.$snack.error(`Error: ${e}`),this.loading=!1}):v(this.selectedTemplate,this.stager.name||this.randomName(),this.form).then(({id:e})=>{this.$snack.success("Stager created"),this.loading=!1,this.$router.push({name:"stagerEdit",params:{id:e}})}).catch(e=>{this.$snack.error(`Error: ${e}`),this.loading=!1}))},async deleteStager(){if(await this.$root.$confirm("Delete",`Are you sure you want to delete stager ${this.form.StarkillerName}?`,{color:"red"}))try{await this.stagerStore.deleteStager(this.id),this.$router.push({name:"stagers"})}catch(e){this.$snack.error(`Error: ${e}`)}},getStager(e){x(e).then(t=>{this.stager=t,this.selectedTemplate=t.template}).catch(()=>{this.errorState=!0})},randomName(){return(Math.random()+1).toString(36).substring(7)},isDownload(e){return e.downloads&&e.downloads.length>0},isOneLiner(e){return e.one_liner},async copy(e){const t=e.downloads.length-1;return this.copyStager(await _(e.downloads[t].id))},async download(e){const t=e.downloads.length-1;return f(e.downloads[t].id)}}};var E=function(){var t=this,s=t._self._c;return s("div",[s(u,{attrs:{breads:t.breads,"show-submit":t.initialLoad,"disable-submit":!t.canEdit&&t.initialLoad,"show-copy":t.id>0&&t.initialLoad,"show-delete":t.id>0&&t.initialLoad,"submit-loading":t.loading&&t.initialLoad,"copy-link":t.copyLink,"small-copy":!0,"small-delete":!0},on:{submit:t.submit,delete:t.deleteStager},scopedSlots:t._u([{key:"extra-stuff",fn:function(){return[t.id>0&&t.initialLoad&&t.isDownload(t.stager)?s(i,{attrs:{color:"success",icon:"fa-download",text:"Download"},on:{click:function(r){return t.download(t.stager)}}}):t._e(),t.id>0&&t.initialLoad&&t.isOneLiner(t.stager)?s(i,{attrs:{color:"success",icon:"fa-paperclip",text:"Copy To Clipboard"},on:{click:function(r){return t.copy(t.stager)}}}):t._e()]},proxy:!0}])}),s("div",{staticClass:"headers"},[s("h3",[t._v(t._s(t.mode)+" Stager")])]),t.errorState?s(m,{attrs:{"resource-id":t.id,"resource-type":"stager"}}):s(y,{staticStyle:{padding:"10px"}},[s(d,{staticClass:"info-viewer",attrs:{info:t.stagerInfo}}),s(c,{attrs:{items:t.stagerTemplateIds,loading:!t.reset,dense:"",outlined:"",label:"Type",readonly:!t.canEdit},model:{value:t.selectedTemplate,callback:function(r){t.selectedTemplate=r},expression:"selectedTemplate"}}),t.selectedTemplate?s(g,[s(n,{attrs:{cols:"6"}},[s(w,{attrs:{outlined:"",dense:"",label:"Name",readonly:!t.canEdit},model:{value:t.stager.name,callback:function(r){t.$set(t.stager,"name",r)},expression:"stager.name"}})],1),s(n,{attrs:{cols:"6"}},[s(L,[t._v(" A name for the stager. Leave blank for an autogenerated name. ")])],1)],1):t._e(),t.reset?s(l,{ref:"generalform",attrs:{options:t.stagerOptions,priority:t.formPriorities,readonly:!t.canEdit},model:{value:t.form,callback:function(r){t.form=r},expression:"form"}}):t._e()],1)],1)},N=[],C=h(k,E,N,!1,null,null,null,null);const W=C.exports;export{W as default};
